function isAlert(){return message.is(":visible")}function isAlertSticky(){return isAlert()&&message.data("sticky")}function showAlert(n,t,i){if(n!=alertTypes.info||!isAlertSticky()){if(message.find(".icon").html(alertIcons[n]),message.find(".text").text(t),message.find(".countdown").text(""),message.data("type",n),message.data("sticky",i?"true":"false"),message.stop().show(),clearTimeout(alertTimeout),n==alertTypes.error||i){message.find(".close").show();return}message.find(".close").hide();updateAlert(alertCountdown)}}function updateAlert(n){if(n==0){closeAlert(!0);return}message.find(".countdown").text(n);alertTimeout=setTimeout(()=>updateAlert(n-1),1e3)}function closeAlert(n){(n||message.data("type")==alertTypes.info)&&message.fadeOut()}function loadHome(){loadPage(home)}function loadPage(n){getHash()==n?loadHash():window.location.hash=n}function loadHash(){var n=getHash();n&&n.length!=2||(n=home);setupAjaxAuth();$.ajax({url:n,method:"GET"}).done(function(n,t,i){if(closeAlert(),i.responseJSON){handleResult(i.responseJSON);return}$("#content").html(n);window.scrollTo(0,0)}).fail(function(n){if(closeAlert(),n.status==401){setupAjaxAuth();$("#content").load(signIn);return}if(n&&n.responseJSON){handleResult(n.responseJSON);return}showAlert(alertTypes.error,"Something went wrong, please try again.")})}function getHash(){return window.location.hash.replace("#","")}function setupLinks(){$("body").on("click","a",function(n){var t=$(this).attr("href");t.startsWith("http")||t!="javascript:void(0)"&&(n.preventDefault(),loadPage(t))})}function handleResult(n){var t=n.message.type==alertTypes.warning||n.message.type==alertTypes.error;if(showAlert(n.message.type,n.message.text,t),n.message.text=="You were signed in."&&n.value)return setAuth(n.value),loadPage(home);if(n.value){if(n.value=="/")return loadPage(home);if(n.value=="refresh")return loadHash();if(v.value.startsWith("/"))return loadPage(n.redirectTo)}}function setupAjaxSubmit(){$("body").on("submit","form",function(n){var t,i,r;if(n.preventDefault(),t=$(this),this.checkValidity()===!1){t.find(":input:visible").not("[formnovalidate]").parent().addClass("was-validated");return}if(t.attr("method").toLowerCase()=="get")return i=t.serialize(),r=t.attr("action")+"?"+i,loadPage(r);submitForm(t)})}function submitForm(n,t,i){var r=n.attr("method")??"POST",u=n.data("replace"),f=n.data("replace-contents");modal&&modal.hide();setupAjaxAuth();$.ajax({method:r,url:t||n.attr("action"),data:i||n.serialize()}).done(function(n,t,i){if(i.responseJSON){handleResult(i.responseJSON);return}if(n&&u){var e=$("#"+u);f?e.html(n):e.replaceWith(n);r=="POST"&&showAlert(alertTypes.success,"Done.");return}showAlert(alertTypes.warning,"Something went wrong, refreshing the page.",!0);loadHash()}).fail(function(n){if(n&&n.responseJSON){handleResult(n.responseJSON);return}showAlert(alertTypes.error,"Something went wrong, please try again.")})}const alertIcons={close:$("<i/>").addClass("fa-solid fa-xmark"),info:$("<i/>").addClass("fa-solid fa-circle-info"),success:$("<i/>").addClass("fa-solid fa-check"),warning:$("<i/>").addClass("fa-solid fa-triangle-exclamation"),error:$("<i/>").addClass("fa-solid fa-ban"),update:$("<i/>").addClass("fa-solid fa-circle-plus"),"delete":$("<i/>").addClass("fa-solid fa-circle-minus"),complete:$("<i/>").addClass("fa-solid fa-circle-check"),save:$("<i/>").addClass("fa-solid fa-ban")},alertTypes={info:"info",success:"success",warning:"warning",error:"error"},message=$(".statusbar .message"),alertCountdown=3;var alertTimeout=0;ready(()=>message.click(()=>closeAlert(!0)));ready(loadHash);window.onhashchange=loadHash;ready(setupLinks);const searchForm=document.getElementById("search");searchForm.addEventListener("shown.bs.collapse",()=>{searchForm.querySelector("input").select()});ready(setupAjaxSubmit);