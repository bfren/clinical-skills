function setAuth(n){n?(localStorage.setItem(jwt_auth_token,"Bearer "+n),setupAjaxAuth()):localStorage.clear()}function setupAjaxAuth(){$.ajaxSetup({beforeSend:n=>{n.setRequestHeader("Authorization",localStorage.getItem(jwt_auth_token))}})}function isAlert(){return message.is(":visible")}function isAlertSticky(){return isAlert()&&message.data("sticky")}function showAlert(n,t,i){if(n!=alertTypes.info||!isAlertSticky()){if(message.find(".icon").html(alertIcons[n]),message.find(".text").text(t),message.find(".countdown").text(""),message.data("type",n),message.data("sticky",i?"true":"false"),message.stop().show(),clearTimeout(alertTimeout),n==alertTypes.error||i){message.find(".close").show();return}message.find(".close").hide();updateAlert(alertCountdown)}}function updateAlert(n){if(n==0){closeAlert(!0);return}message.find(".countdown").text(n);alertTimeout=setTimeout(()=>updateAlert(n-1),1e3)}function closeAlert(n){(n||message.data("type")==alertTypes.info)&&message.fadeOut()}function loadHome(){loadPage(home)}function loadPage(n){getHash()==n?loadHash():window.location.hash=n}function loadHash(){var n=getHash();n&&n.length!=2||(n=home);setupAjaxAuth();$.ajax({url:n,method:"GET"}).done(function(n,t,i){if(closeAlert(),i.responseJSON){handleResult(i.responseJSON);return}$("#content").html(n);window.scrollTo(0,0)}).fail(function(n){if(closeAlert(),n.status==401){setupAjaxAuth();$("#content").load(signIn);return}if(n&&n.responseJSON){handleResult(n.responseJSON);return}showAlert(alertTypes.error,"Something went wrong, please try again.")});$.ajax({url:sidebar,method:"GET"}).done(function(n){$("#content").removeClass("w-100");$("#sidebar-content").html(n)}).fail(function(){$("#content").addClass("w-100");$("#sidebar-content").html("")})}function getHash(){return window.location.hash.replace("#","")}function setupLinks(){$("body").on("click","a",function(n){var t=$(this).attr("href");t.startsWith("http")||t!="javascript:void(0)"&&(n.preventDefault(),loadPage(t))})}function openCreateModal(n){openModal("#create",n,null,!0,()=>{setupCreateModalSearch(),setupCreateModalUnknown()})}function setupCreateModalSearch(){$("#create .list-filter").keydown(function(n){n.keyCode==13&&n.preventDefault()});$("#create .list-filter").keyup(function(){var n=$(this).val().toString(),t=$(this).data("filter-for");filterModalItems(t,n)})}function setupCreateModalUnknown(){$(".unknown-toggle").on("change",function(){if($(this).is(":checked"))$(".unknown").val("").attr("disabled",!0).blur();else{var n=$(".unknown-value").val();$(".unknown").val(n).removeAttr("disabled").select()}})}function setupCreateModalOpen(){$("body").on("click",".btn-create",function(n){n.preventDefault();var t=$(this).data("create");openCreateModal(t)})}function setupCreateModalSave(){$("body").on("click","#create .btn-save",()=>$("#create form").submit())}function openDeleteModal(n,t){openModal("#delete",n,t,!0)}function setupDeleteModalOpen(){$("body").on("click",".btn-delete-check",function(n){checkDeleteItem($(this),n)})}function setupDeleteModalSave(){$("body").on("click","#delete .btn-delete",function(){$("#delete form").submit();modal.hide()})}function checkDeleteItem(n,t){t.preventDefault();var i=n.data("delete"),r=n.data("replace");openDeleteModal(i,r)}function setupChangePasswordUpdateModal(){$("body").on("click",".change-password",function(n){n.preventDefault();var t=$(this).data("change");openUpdateModal(t,null)})}function openUpdateModal(n,t,i){openModal("#update",n,t,i,()=>setupUpdateModalSearch())}function setupUpdateModalOpen(){$("body").on("click",".btn-update",function(n){n.preventDefault();var t=$(this).data("update"),i=$(this).data("replace"),r=$(this).data("replace-contents");openUpdateModal(t,i,r)})}function setupUpdateModalSearch(){var n=$("#update .btn-add");n.hide();n.not(":disabled")&&n.click(addNewItemToJourney);$("#update .list-filter").keydown(function(t){t.keyCode==13&&(t.preventDefault(),n.not(":disabled")&&n.click())});$("#update .list-filter").keyup(function(){var t=$(this).val().toString(),i=$(this).data("filter-for"),r=filterModalItems(i,t);n.is(":disabled")||(t&&!r?n.text("Add: "+t).show():n.text("").hide())})}function setupUpdateModalSave(){var n=n=>{n.preventDefault(),$("#update form").submit()};$("body").on("click","#update .btn-save",n);$("body").on("change","#update .auto-save",n);$("body").on("keypress","#update input",function(t){t.keyCode==13&&n(t)})}function setupTokenUpdateModals(){$("body").on("click",".token > a, .btn-complete",function(){var n=$(this).data("update"),t=$(this).data("replace");openUpdateModal(n,t,!1)})}function addNewItemToJourney(){var n={id:$("#Journey_Id").val(),version:$("#Journey_Version").val(),value:$("#update .list-filter").val(),__requestVerificationToken:$("#update [name=__RequestVerificationToken]").val()},t=$(this).data("url");submitForm($("#update form"),t,n)}function handleResult(n){var t=n.message.type==alertTypes.warning||n.message.type==alertTypes.error;if(showAlert(n.message.type,n.message.text,t),n.message.text=="You were signed in."&&n.value)return setAuth(n.value),loadPage(home);if(n.value){if(n.value=="/")return loadPage(home);if(n.value=="refresh")return loadHash();if(v.value.startsWith("/"))return loadPage(n.redirectTo)}}function setupSettingsTabs(){$("body").on("click","#settingsButtons .nav-link",function(){var n=$(this).data("bs-target");loadSettingsTab(n)})}function loadSettingsTab(n){var t=$(n),i=t.data("src");setupAjaxAuth();t.load(i,()=>closeAlert())}function loadSaveForm(n,t,i){var r,u;(i.preventDefault(),r="btn-delete-check",$(i.target).hasClass(r)||$(i.target).parents("."+r).length>0)||(u=t.data("load"),setupAjaxAuth(),$("#save-"+n).load(u,()=>closeAlert()))}function setupSaveFormOnEnter(n){$(n).on("keydown","input",function(t){t.keyCode==13&&(t.preventDefault(),$(n).find(".btn-save").click())})}function selectInputOnLoad(){$(".select-on-load").select()}function setupAjaxSubmit(){$("body").on("submit","form",function(n){var t,i,r;if(n.preventDefault(),t=$(this),this.checkValidity()===!1){t.find(":input:visible").not("[formnovalidate]").parent().addClass("was-validated");return}if(t.attr("method").toLowerCase()=="get")return i=t.serialize(),r=t.attr("action")+"?"+i,loadPage(r);submitForm(t)})}function submitForm(n,t,i){var r=n.attr("method")??"POST",u=n.data("replace"),f=n.data("replace-contents");modal&&modal.hide();setupAjaxAuth();$.ajax({method:r,url:t||n.attr("action"),data:i||n.serialize()}).done(function(n,t,i){if(i.responseJSON){handleResult(i.responseJSON);return}if(n&&u){var e=$("#"+u);f?e.html(n):e.replaceWith(n);r=="POST"&&showAlert(alertTypes.success,"Done.");return}showAlert(alertTypes.warning,"Something went wrong, refreshing the page.",!0);loadHash()}).fail(function(n){if(n&&n.responseJSON){handleResult(n.responseJSON);return}showAlert(alertTypes.error,"Something went wrong, please try again.")})}var alertTimeout,modal;const jwt_auth_token="jwt";const alertIcons={close:$("<i/>").addClass("fa-solid fa-xmark"),info:$("<i/>").addClass("fa-solid fa-circle-info"),success:$("<i/>").addClass("fa-solid fa-check"),warning:$("<i/>").addClass("fa-solid fa-triangle-exclamation"),error:$("<i/>").addClass("fa-solid fa-ban"),update:$("<i/>").addClass("fa-solid fa-circle-plus"),"delete":$("<i/>").addClass("fa-solid fa-circle-minus"),complete:$("<i/>").addClass("fa-solid fa-circle-check"),save:$("<i/>").addClass("fa-solid fa-ban")},alertTypes={info:"info",success:"success",warning:"warning",error:"error"},message=$(".statusbar .message"),alertCountdown=3;alertTimeout=0;ready(()=>message.click(()=>closeAlert(!0)));ready(loadHash);window.onhashchange=loadHash;ready(setupLinks);ready(setupCreateModalOpen);ready(setupCreateModalSave);ready(setupDeleteModalOpen);ready(setupDeleteModalSave);ready(setupChangePasswordUpdateModal);ready(setupUpdateModalOpen);ready(setupUpdateModalSave);ready(setupTokenUpdateModals);const searchForm=document.getElementById("search");searchForm.addEventListener("shown.bs.collapse",()=>{searchForm.querySelector("input").select()});ready(setupSettingsTabs);ready(setupAjaxSubmit);